# NOTE  May be possible to test multiple languages:
#       
#       https://stackoverflow.com/questions/27644586/how-to-set-up-travis-ci-with-multiple-languages
#       
#       Though seems like that runs them in different instances, where as we
#       just need Python and NodeJS available in the Ruby spec... which I
#       figured out, see below...
# 

# disable the default submodule logic
# See https://gist.github.com/iedemam/9830045
git:
  submodules: false

os:
  - linux
  - osx

before_install:
  # Replace the SSH URL with the public URL, then init and update
  # submodules
  - ./test/bin/git-submod-ssh-to-https.rb
  - git submodule update --init --recursive
  
  # Travis Linux has 2.7.14 pre-installed in pyenv, so use that
  #
  # We need to install on OSX
  - |
      if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        pyenv install 2.7.14
        echo 'eval "$(pyenv init -)"' > ~/.bash_profile
        source ~/.bash_profile
        pyenv global 2.7.14
        brew install yarn
      fi
  
  # Set the global on both OS
  - pyenv global 2.7.14
  
  # Install requirements (Ansible and QB Python module/filter deps)
  - pip install -r requirements.txt
  
  - which ansible-playbook
  - ansible --version
  
  # Install `//package.json` to get `semver`
  - yarn
  
  # Install gem
  - gem update --system
  - gem install bundler
  
language: ruby

rvm:
  # The min Ruby requirement in the gemspec
  - 2.3.0
  # The most recent patch of all more recent minor versions
  - 2.3.6
  - 2.4.3
  - 2.5.0

script: bundle exec rspec

sudo: false

cache: bundler
